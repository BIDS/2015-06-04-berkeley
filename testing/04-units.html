<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Testing</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">Testing</h1>
          <h2 class="subtitle">Unit Tests</h2>
<section class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Understand that functions are the atomistic unit of software.</li>
<li>Understand that simpler units are easier to test than complex ones.</li>
<li>Understand how to write a single unit test.</li>
<li>Understand how to run a single unit test.</li>
<li>Understand how test fixtures can help write tests.</li>
</ul>
</div>
</section>
<p>Unit tests are so called because they exercise the functionality of the code by interrogating individual functions and methods. Fuctions and methods can often be considered the atomic units of software because they are indivisble. However, what is considered to be the smallest code <em>unit</em> is subjective. The body of a function can be long are short, and shorter functions are arguably more unit-like than long ones.</p>
<p>Thus what reasonably constitutes a code unit typically varies from project to project and language to language. A good guideline is that if the code cannot be made any simpler logically (you cannot split apart the addition operator) or practically (a function is self-contained and well defined), then it is a unit.</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Functions are Like Paragraphs</h2>
</div>
<div class="panel-body">
<p>Recall that humans can only hold a few ideas in our heads at once. Paragraphs in books, for example, become unwieldy after a few lines. Functions, generaly, shouldn’t be longer than paragraphs. Robert C. Martin, the author of “Clean Code” said : TODO</p>
</div>
</aside>
<p>The desire to unit test code often has the effect of encouraging both the code and the tests to be as small, well-defined, and modular as possible.<br />In Python, unit tests typically take the form of test functions.</p>
<p>Consider the following example that could arise when comunicating with third-party programs. You have a function <code>f()</code> which will write a file named <code>yes.txt</code> to disk with the value 42 but only if a file <code>no.txt</code> does not exist. To truly test the function works, you would want to ensure that neither <code>yes.txt</code> nor <code>no.txt</code> existed before you ran your test. After the test, you want to clean up after yourself before the next test comes along. You could write the test, setup, and teardown functions as follows:</p>
<h2 id="sourcepython">[source,python]</h2>
<p>import os</p>
<p>from nose.tools import assert_equal, with_setup</p>
<p>from mod import f</p>
<p>def f_setup(): &lt;1&gt; files = os.listdir(‘.’) if ‘no.txt’ in files: os.remove(‘no.txt’) if ‘yes.txt’ in files: os.remove(‘yes.txt’)</p>
<p>def f_teardown(): &lt;2&gt; files = os.listdir(‘.’) if ‘yes.txt’ in files: os.remove(‘yes.txt’)</p>
<p>def test_f(): f_setup() &lt;3&gt; exp = 42 f() with open(‘yes.txt’, ‘r’) as fhandle: obs = int(fhandle.read()) assert_equal(exp, obd) f_teardown() &lt;4&gt; ————— &lt;1&gt; The +f_setup()+ function tests ensure that neither the +yes.txt+ nor the +no.txt+ files exist. &lt;2&gt; The +f_teardown()+ function removes the +yes.txt+ file, if it was created. &lt;3&gt; The first action of +test_f()+ is to make sure the file system is clean. &lt;4&gt; The last action of +test_f()+ is to clean up after itself.</p>
<p>The above implementation of test fixtures is usually fine. However, it does not guarantee that the +f_setup()+ and the +f_teardown()+ functions will be called. This is becaue an unexpected error anywhere in the body of +f()+ or +test_f()+ will cause the test to abort before the teardown function is reached. To make sure that both of the fixtures will be executed, you must use nose’s +with_setup()+ decorator. This decorator may be applied to any test and takes a setup and a teardown function as possible arguments. We can rewrite the +test_f()+ to be wrapped by +with_setup()+.</p>
<h2 id="sourcepython-1">[source,python]</h2>
<p><span class="citation">@with_setup</span>(setup=f_setup, teardown=f_teardown) def test_f(): exp = 42 f() with open(‘yes.txt’, ‘r’) as fhandle: obs = int(fhandle.read()) assert_equal(exp, obd) —————</p>
<p>Note that if you have functions in your test module that are simply named +setup()+ and +teardown()+, each of these are called automatically when the entire test module is loaded in and finished.</p>
<p>.Write Simple Functions [TIP] ==== Simple tests are the easiest to write. For this reason, functions should be small enough that they are easy to test. For more information on writing code that facilitates tests, we recommend the Robert C. Martin book, ‘Clean Code.’ ====</p>
<p>Having introduced the concept of unit tests, we can now go up a level in complexity.</p>
<p><em>Aside on Fixtures</em></p>
<p>Additionally, unit tests may have <em>test fixtures</em>. A fixture is anything that may be added to the test that creates or removes the environment required by the test to successfully run. They are not part of expected result, the observed result, or the assertion. Test fixtures are completely optional.</p>
<p>A fixture that is executed before the test to prepare the environment is called a <em>setup</em> function. One that is executed to mop-up side effects after a test is run is called a <em>teardown</em> function. Nose has a decorator that you can use to automatically run fixtures no matter if the test succeeded, failed, or had an error.</p>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Places to Create Git Repositories</h2>
</div>
<div class="panel-body">
<p>Dracula starts a new project, <code>moons</code>, related to his <code>planets</code> project. Despite Wolfman’s concerns, he enters the following sequence of commands to create one Git repository inside another:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span>             <span class="co"># return to home directory</span>
<span class="kw">mkdir</span> planets  <span class="co"># make a new directory planets</span>
<span class="kw">cd</span> planets     <span class="co"># go into planets</span>
<span class="kw">git</span> init       <span class="co"># make the planets directory a Git repository</span>
<span class="kw">mkdir</span> moons    <span class="co"># make a sub-directory planets/moons</span>
<span class="kw">cd</span> moons       <span class="co"># go into planets/moons</span>
<span class="kw">git</span> init       <span class="co"># make the moons sub-directory a Git repository</span></code></pre>
<p>Why is it a bad idea to do this? How can Dracula “undo” his last <code>git init</code>?</p>
</div>
</section>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/git-novice">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
